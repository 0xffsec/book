<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SMB (Server Message Block) Enumeration for Pentesting"><meta property="og:title" content="SMB - 139 / 445"><meta property="og:description" content="SMB (Server Message Block) Enumeration for Pentesting"><meta property="og:type" content="article"><meta property="og:url" content="https://0xffsec.com/notebook/enumeration/smb/"><meta property="article:modified_time" content="2020-05-20T17:19:08+02:00"><title>SMB - 139 / 445 | Notebook</title><link rel=icon href=/notebook/favicon.png type=image/x-icon><link rel=stylesheet href=/notebook/book.min.6df681b0bb21155cba49f6078e3559216772d8e03e780d240c73ea21817ed5e5.css integrity="sha256-bfaBsLshFVy6SfYHjjVZIWdy2OA+eA0kDHPqIYF+1eU="><script defer src=/notebook/en.search.min.425b1fe6b2a99b4081b3cb8f809382696a2e8471d3cd91a02e5a53f914e5eb9c.js integrity="sha256-Qlsf5rKpm0CBs8uPgJOCaWouhHHTzZGgLlpT+RTl65w="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/notebook><span>Notebook</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/notebook/preface/>Preface</a></li><li><span>Discovery and Scanning</span><ul><li><a href=/notebook/discovery-and-scanning/host-discovery/>Host Discovery</a></li><li><a href=/notebook/discovery-and-scanning/port-scanning/>Port Scanning</a></li></ul></li><li><a href=/notebook/exploits-search/>Exploits Search</a></li><li><a href=/notebook/enumeration/>Enumeration</a><ul><li><a href=/notebook/enumeration/ftp/>FTP - 21</a></li><li><a href=/notebook/enumeration/http-https/>HTTP/S - 80 / 443</a></li><li><a href=/notebook/enumeration/smb/ class=active>SMB - 139 / 445</a></li></ul></li><li><span>Exploitation</span><ul></ul></li><li><span>Notes</span><ul><li><a href=/notebook/notes/smb-protocol-negotiation-failed/>SMB Protocol Negotiation Failed</a></li><li><a href=/notebook/notes/ssh-legacy-key-exchange/>SSH Legacy Key Exchange</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/notebook/svg/menu.svg class=book-icon alt=Menu></label>
<strong>SMB - 139 / 445</strong>
<label for=toc-control><img src=/notebook/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#smb-host-discovery>SMB Host Discovery</a></li><li><a href=#server-version>Server Version</a><ul><li><a href=#metasploit-smb-auxiliary-module-metasploit-smb-auxiliary-module>Metasploit SMB Auxiliary Module</a></li></ul></li><li><a href=#smb-exploits-search>SMB Exploits Search</a></li><li><a href=#common-login-credentials>Common Login Credentials</a></li><li><a href=#list-shares>List Shares</a><ul><li><a href=#smbclient-smbclient>smbclient</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1>SMB</h1><blockquote class="book-hint warning">Server Message Block.</br><strong>Default Port: 139 / 445</strong></blockquote><p>SMB is a network communication protocol for providing shared access to files, printers, and serial ports between nodes on a network. It also provides an authenticated IPC (inter-process communication) mechanism.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><h4 id=windows-smb-ports-and-protocols>Windows SMB Ports and Protocols</h4><blockquote class="book-hint info"><strong>TL;DR</strong></p><ul><li>Port 139: SMB over NBT (NetBIOS over TCP/IP).</li><li>port 445: SMB directly over TCP/IP.</li></ul></blockquote><p>Originally, in Windows NT, SMB ran on top of NBT (NetBIOS over TCP/IP), which uses ports UDP 137 and 138, and TCP 139. With Windows 2000, was introduced the option to run &ldquo;NetBIOS-less&rdquo; SMB directly over TCP/IP, without the extra NBT layer on port 445.<br>Older versions of Windows (with NBT enabled) will try to connect to both port 139 and 445 simultaneously, while in newer versions, port 139 is a fall-back port, as clients will try to connect to port 445 by default.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><h2 id=smb-host-discovery>SMB Host Discovery</h2><p>Refer to <a href=https://0xffsec.com/notebook/discovery-and-scanning/host-discovery/#nbtscan---netbios-nbtscan>host discovert with nbtscan</a>.</p><h2 id=server-version>Server Version</h2><h3 id=metasploit-smb-auxiliary-module-metasploit-smb-auxiliary-module>Metasploit SMB Auxiliary Module <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>msf&gt; use auxiliary/scanner/smb/smb_version
msf&gt; <span style=color:#8be9fd;font-style:italic>set</span> rhost 10.0.0.3
msf&gt; run
</code></pre></div><h2 id=smb-exploits-search>SMB Exploits Search</h2><p>Refer to <a href=https://0xffsec.com/notebook/exploits-search/>Exploits Search</a></p><h2 id=common-login-credentials>Common Login Credentials</h2><p>Backup and Management software requires dedicated user accounts on the server or local machine to function, and are often set with a weak password. <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><table><thead><tr><th>Usernmae</th><th>Password</th></tr></thead><tbody><tr><td>(blank)</td><td>(blank)</td></tr><tr><td><code>Administrator</code> <code>admin</code> <code>guest</code></td><td>(blank) <code>admin</code> <code>password</code></td></tr><tr><td><code>arcserve</code></td><td><code>arcserve</code> <code>backup</code></td></tr><tr><td><code>tivoli</code></td><td><code>tivoli</code></td></tr><tr><td><code>backupexec</code></td><td><code>backupexec</code> <code>backup</code></td></tr><tr><td><code>test</code></td><td><code>test</code></td></tr></tbody></table><h2 id=list-shares>List Shares</h2><p>Look for available shares using default credentials.</p><h3 id=smbclient-smbclient>smbclient <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>smbclient --no-pass -L //10.0.0.3
</code></pre></div><details><summary>Parameters</summary><ul><li><code>--no-pass</code>: remove the password prompt from the client to the user.</li><li><code>-L</code>: list services available on the server.</li></ul></details><h1 id=reference>Reference</h1><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Contributors to Wikimedia projects. “Server Message Block - Wikipedia.” Wikipedia, the Free Encyclopedia, Wikimedia Foundation, Inc., 26 Oct. 2003, <a href=https://en.wikipedia.org/wiki/Server_Message_Block>https://en.wikipedia.org/wiki/Server_Message_Block</a>. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>“The Use of TCP Ports 139 and 445 in Windows.” Vidstrom Labs, <a href=https://vidstromlabs.com/blog/the-use-of-tcp-ports-139-and-445-in-windows/>https://vidstromlabs.com/blog/the-use-of-tcp-ports-139-and-445-in-windows/</a>. <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>“Scanner SMB Auxiliary Modules - Metasploit Unleashed.” Infosec Training and Penetration Testing | Offensive Security, <a href=https://www.offensive-security.com/metasploit-unleashed/scanner-smb-auxiliary-modules/>https://www.offensive-security.com/metasploit-unleashed/scanner-smb-auxiliary-modules/</a>. <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>McNab, Chris. Network Security Assessment. “O’Reilly Media, Inc.,” 2007, p. 281. <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>“Smbclient.” Samba - Opening Windows to a Wider World, <a href=https://www.samba.org/samba/docs/current/man-html/smbclient.1.html>https://www.samba.org/samba/docs/current/man-html/smbclient.1.html</a>. <a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></article><footer class=book-footer><div class="flex justify-between"><div><a class="flex align-center" href=https://github.com/0xffsec/notebook/commit/f7902b0c0ef62a22b4cfebb0aaf66341081f7220 title="Last modified by Max Rodrigo | May 20, 2020" target=_blank rel=noopener><img src=/notebook/svg/calendar.svg class=book-icon alt=Calendar>
<span>May 20, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/0xffsec/notebook/edit/master/content//enumeration/smb.md target=_blank rel=noopener><img src=/notebook/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#smb-host-discovery>SMB Host Discovery</a></li><li><a href=#server-version>Server Version</a><ul><li><a href=#metasploit-smb-auxiliary-module-metasploit-smb-auxiliary-module>Metasploit SMB Auxiliary Module</a></li></ul></li><li><a href=#smb-exploits-search>SMB Exploits Search</a></li><li><a href=#common-login-credentials>Common Login Credentials</a></li><li><a href=#list-shares>List Shares</a><ul><li><a href=#smbclient-smbclient>smbclient</a></li></ul></li></ul></nav></aside></main></body></html>