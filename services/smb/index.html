<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SMB (Server Message Block) Enumeration for Pentesting"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="SMB - 139 / 445"><meta property="og:description" content="SMB (Server Message Block) Enumeration for Pentesting"><meta property="og:type" content="article"><meta property="og:url" content="https://0xffsec.com/book/services/smb/"><meta property="article:modified_time" content="2020-07-30T15:44:01+02:00"><title>SMB - 139 / 445 | 0xffsec Penetration Testing Book</title><link rel=manifest href=/book/manifest.json><link rel=icon href=/book/favicon.png type=image/x-icon><link rel=stylesheet href=/book/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/book/en.search.min.9572987f47092e3df365eaab6a1cc1f19fc87ec12e699c12d3a3ee8d3f9fd80c.js integrity="sha256-lXKYf0cJLj3zZeqrahzB8Z/IfsEuaZwS06PujT+f2Aw="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-142676329-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/book><span>0xffsec Penetration Testing Book</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/book/preface/>Preface</a></li><li><span>Discovery and Scanning</span><ul><li><a href=/book/discovery-and-scanning/host-discovery/>Host Discovery</a></li><li><a href=/book/discovery-and-scanning/port-scanning/>Port Scanning</a></li></ul></li><li><a href=/book/exploits-search/>Exploits Search</a></li><li><a href=/book/services/>Services</a><ul><li><a href=/book/services/ftp/>FTP - 21</a></li><li><a href=/book/services/smtp/>SMTP - 25 / 465 / 587</a></li><li><a href=/book/services/dns/>DNS - 53</a></li><li><a href=/book/services/http-https/>HTTP/S - 80 / 443</a></li><li><a href=/book/services/pop/>POP - 110 / 995</a></li><li><a href=/book/services/nntp/>NNTP - 119 / 433 / 563</a></li><li><a href=/book/services/smb/ class=active>SMB - 139 / 445</a></li><li><a href=/book/services/imap/>IMAP - 143 / 993</a></li></ul></li><li><span>Web Applications</span><ul><li><a href=/book/web-applications/cgi/>CGI</a></li><li><a href=/book/web-applications/file-inclusion-and-path-traversal/>File Inclusion</a></li></ul></li><li><a href=/book/reverse-shells/>Reverse Shells</a></li><li><a href=/book/notes/ class=collapsed>Notes</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/book/svg/menu.svg class=book-icon alt=Menu></label>
<strong>SMB - 139 / 445</strong>
<label for=toc-control><img src=/book/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#smb-host-discovery>SMB Host Discovery</a></li><li><a href=#server-version>Server Version</a><ul><li><a href=#metasploit-smb-auxiliary-module-metasploit-smb-auxiliary-module>Metasploit SMB Auxiliary Module</a></li></ul></li><li><a href=#smb-exploits-search>SMB Exploits Search</a></li><li><a href=#common-login-credentials>Common Login Credentials</a></li><li><a href=#list>List</a><ul><li><a href=#smbclient-smbclient>smbclient</a></li></ul></li><li><a href=#connect>Connect</a><ul><li><a href=#smbclient-smbclient-1>smbclient</a></li></ul></li><li><a href=#mount-mount-smb>Mount</a></li><li><a href=#null-session-enumeration>Null Session Enumeration</a><ul><li><a href=#windows-administrative-shares>Windows Administrative Shares</a></li><li><a href=#ipc-share>IPC$ Share</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=smb>SMB</h1><blockquote class="book-hint info"><p>Server Message Block.</p><p><strong>Default Ports</strong></p><ul><li>SMB over NetBIOS (NetBIOS over TCP/IP): 139</li><li>SMB over TCP/IP: 445</li></ul></blockquote><p>SMB is a network communication protocol for providing shared access to files, printers, and serial ports between nodes on a network. It also provides an authenticated IPC (inter-process communication) mechanism.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><h4 id=windows-smb-ports-and-protocols>Windows SMB Ports and Protocols</h4><p>Originally, in Windows NT, SMB ran on top of NBT (NetBIOS over TCP/IP), which uses ports UDP 137 and 138, and TCP 139. With Windows 2000, was introduced the option to run &ldquo;NetBIOS-less&rdquo; SMB directly over TCP/IP, without the extra NBT layer on port 445.
Older versions of Windows (with NBT enabled) will try to connect to both port 139 and 445 simultaneously, while in newer versions, port 139 is a fall-back port, as clients will try to connect to port 445 by default.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><h2 id=smb-host-discovery>SMB Host Discovery</h2><p>Refer to <a href=https://0xffsec.com/book/discovery-and-scanning/host-discovery/#nbtscan---netbios-nbtscan>host discovert with nbtscan</a>.</p><h2 id=server-version>Server Version</h2><h3 id=metasploit-smb-auxiliary-module-metasploit-smb-auxiliary-module>Metasploit SMB Auxiliary Module <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></h3><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>msf&gt; use auxiliary/scanner/smb/smb_version
msf&gt; <span style=color:#24909d>set</span> rhost 10.0.0.3
msf&gt; run
</code></pre></div><h2 id=smb-exploits-search>SMB Exploits Search</h2><p>Refer to <a href=https://0xffsec.com/book/exploits-search/>Exploits Search</a></p><h2 id=common-login-credentials>Common Login Credentials</h2><p>Backup and Management software requires dedicated user accounts on the server or local machine to function, and are often set with a weak password. <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><table><thead><tr><th>Usernmae</th><th>Password</th></tr></thead><tbody><tr><td>(blank)</td><td>(blank)</td></tr><tr><td><code>Administrator</code> <code>admin</code> <code>guest</code></td><td>(blank) <code>admin</code> <code>password</code></td></tr><tr><td><code>arcserve</code></td><td><code>arcserve</code> <code>backup</code></td></tr><tr><td><code>tivoli</code></td><td><code>tivoli</code></td></tr><tr><td><code>backupexec</code></td><td><code>backupexec</code> <code>backup</code></td></tr><tr><td><code>test</code></td><td><code>test</code></td></tr></tbody></table><h2 id=list>List</h2><p>Look for available shares using default credentials.</p><h3 id=smbclient-smbclient>smbclient <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></h3><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>smbclient -N -L //10.0.0.3
</code></pre></div><details><summary>Parameters</summary><ul><li><code>-N</code>: remove the password prompt from the client to the user.</li><li><code>-L</code>: list services available on the server.</li></ul></details><h2 id=connect>Connect</h2><h3 id=smbclient-smbclient-1>smbclient <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></h3><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>smbclient -N //10.0.0.3/Share
</code></pre></div><h2 id=mount-mount-smb>Mount <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></h2><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mount -t cifs -o <span style=color:#40ffff>username</span>=user,password=password //10.0.0.3/Share /mnt/share
</code></pre></div><h2 id=null-session-enumeration>Null Session Enumeration</h2><h3 id=windows-administrative-shares>Windows Administrative Shares</h3><p>Administrative shares are hidden shares that provide administrators the ability to remotely manage hosts. <strong>They are automatically created and enabled by default</strong>.</p><blockquote class="book-hint info">It is worth clarifying these shares are not hidden but removed from views just by appending a dollar sign (<code>$</code>) to the share name. Ultimately, the share will be part of the result if listing from a Unix-based system or by using: <code>net share</code> and <code>net view /all</code>.</blockquote><p>Three common shares are:</p><ul><li><code>C$</code>: allows access to the C Drive on the remote machine.</li><li><code>Admin$</code>: allows access to the Windows installation directory.</li><li><code>IPC$</code>: allows inter-process communication or IPC.</li></ul><h3 id=ipc-share>IPC$ Share</h3><p><code>IPC$</code> is a special share used to facilitate inter-process communication (<code>IPC</code>). In other words, it does not allow access to files or directories, but it allows to communicate with processes running on the remote system.
Specifically, <strong><code>IPC$</code> exposes named pipes</strong>, which can be written or read to communicate with remote processes. These named pipes are created when an application opens a pipe and registers it with SMB so that it can be exposed by the <code>IPC$</code> share.
On the one hand, data written to the named pipe is sent to the remote process, and on the other hand, a local application reads the output information written by the remote process. They are usually used to perform specific functions on the remote system, also known as <strong>RPC</strong> or remote procedure calls.</p><p>Some versions of Windows allow you to authenticate and mount the <code>IPC$</code> share without providing a username and password. Such a connection is often called a NULL session, which, despite its limited privileges, could be used to make multiple RPC calls and obtain useful information about the remote system.<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup></p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Contributors to Wikimedia projects. “Server Message Block - Wikipedia.” Wikipedia, the Free Encyclopedia, Wikimedia Foundation, Inc., 26 Oct. 2003, <a href=https://en.wikipedia.org/wiki/Server_Message_Block>https://en.wikipedia.org/wiki/Server_Message_Block</a>. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>“The Use of TCP Ports 139 and 445 in Windows.” Vidstrom Labs, <a href=https://vidstromlabs.com/blog/the-use-of-tcp-ports-139-and-445-in-windows/>https://vidstromlabs.com/blog/the-use-of-tcp-ports-139-and-445-in-windows/</a>. <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>“Scanner SMB Auxiliary Modules - Metasploit Unleashed.” Infosec Training and Penetration Testing | Offensive Security, <a href=https://www.offensive-security.com/metasploit-unleashed/scanner-smb-auxiliary-modules/>https://www.offensive-security.com/metasploit-unleashed/scanner-smb-auxiliary-modules/</a>. <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>McNab, Chris. Network Security Assessment. “O’Reilly Media, Inc.,” 2007, p. 281. <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>“Smbclient.” Samba - Opening Windows to a Wider World, <a href=https://www.samba.org/samba/docs/current/man-html/smbclient.1.html>https://www.samba.org/samba/docs/current/man-html/smbclient.1.html</a>. <a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6 role=doc-endnote><p>“Mounting Samba Shares from a Unix Client.” SambaWiki, <a href=https://wiki.samba.org/index.php/Mounting_samba_shares_from_a_unix_client>https://wiki.samba.org/index.php/Mounting_samba_shares_from_a_unix_client</a>. <a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7 role=doc-endnote><p>“A New Look at Null Sessions and User Enumeration.” SensePost, <a href=https://sensepost.com/blog/2018/a-new-look-at-null-sessions-and-user-enumeration/>https://sensepost.com/blog/2018/a-new-look-at-null-sessions-and-user-enumeration/</a>. <a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/0xffsec/book/commit/9e120a70990c3bdc517429eb1d67966501350b95 title="Last modified by Max Rodrigo | July 30, 2020" target=_blank rel=noopener><img src=/book/svg/calendar.svg class=book-icon alt=Calendar>
<span>July 30, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/0xffsec/book/edit/master/content//services/smb.md target=_blank rel=noopener><img src=/book/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#smb-host-discovery>SMB Host Discovery</a></li><li><a href=#server-version>Server Version</a><ul><li><a href=#metasploit-smb-auxiliary-module-metasploit-smb-auxiliary-module>Metasploit SMB Auxiliary Module</a></li></ul></li><li><a href=#smb-exploits-search>SMB Exploits Search</a></li><li><a href=#common-login-credentials>Common Login Credentials</a></li><li><a href=#list>List</a><ul><li><a href=#smbclient-smbclient>smbclient</a></li></ul></li><li><a href=#connect>Connect</a><ul><li><a href=#smbclient-smbclient-1>smbclient</a></li></ul></li><li><a href=#mount-mount-smb>Mount</a></li><li><a href=#null-session-enumeration>Null Session Enumeration</a><ul><li><a href=#windows-administrative-shares>Windows Administrative Shares</a></li><li><a href=#ipc-share>IPC$ Share</a></li></ul></li></ul></nav></aside></main></body></html>