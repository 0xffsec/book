<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MSRPC  Microsoft Remote Procedure Call.
Default Ports:
 RPC Endpoint Mapper: 135 HTTP: 593   MSRPC is an interprocess communication (IPC) mechanism that allows client/server software communcation. That process can be on the same computer, on the local network (LAN), or across the Internet. Its purpose is to provide a common interface between applications.
Within Windows environments, many server applications are exposed via RPC.
The Microsoft RPC mechanism uses other IPC mechanisms, such as named pipes, NetBIOS or Winsock, to establish communications between the client and the server."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="MSRPC (Microsoft Remote Procedure Call) Service Enumeration"><meta property="og:description" content="MSRPC  Microsoft Remote Procedure Call.
Default Ports:
 RPC Endpoint Mapper: 135 HTTP: 593   MSRPC is an interprocess communication (IPC) mechanism that allows client/server software communcation. That process can be on the same computer, on the local network (LAN), or across the Internet. Its purpose is to provide a common interface between applications.
Within Windows environments, many server applications are exposed via RPC.
The Microsoft RPC mechanism uses other IPC mechanisms, such as named pipes, NetBIOS or Winsock, to establish communications between the client and the server."><meta property="og:type" content="article"><meta property="og:url" content="https://0xffsec.com/handbook/services/msrpc/"><meta property="og:image" content="https://0xffsec.com/handbook/images/banner.png"><meta property="article:modified_time" content="2020-10-25T13:50:06+01:00"><meta itemprop=name content="MSRPC (Microsoft Remote Procedure Call) Service Enumeration"><meta itemprop=description content="MSRPC  Microsoft Remote Procedure Call.
Default Ports:
 RPC Endpoint Mapper: 135 HTTP: 593   MSRPC is an interprocess communication (IPC) mechanism that allows client/server software communcation. That process can be on the same computer, on the local network (LAN), or across the Internet. Its purpose is to provide a common interface between applications.
Within Windows environments, many server applications are exposed via RPC.
The Microsoft RPC mechanism uses other IPC mechanisms, such as named pipes, NetBIOS or Winsock, to establish communications between the client and the server."><meta itemprop=dateModified content="2020-10-25T13:50:06+01:00"><meta itemprop=wordCount content="625"><meta itemprop=image content="https://0xffsec.com/handbook/images/banner.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0xffsec.com/handbook/images/banner.png"><meta name=twitter:title content="MSRPC (Microsoft Remote Procedure Call) Service Enumeration"><meta name=twitter:description content="MSRPC  Microsoft Remote Procedure Call.
Default Ports:
 RPC Endpoint Mapper: 135 HTTP: 593   MSRPC is an interprocess communication (IPC) mechanism that allows client/server software communcation. That process can be on the same computer, on the local network (LAN), or across the Internet. Its purpose is to provide a common interface between applications.
Within Windows environments, many server applications are exposed via RPC.
The Microsoft RPC mechanism uses other IPC mechanisms, such as named pipes, NetBIOS or Winsock, to establish communications between the client and the server."><title>MSRPC (Microsoft Remote Procedure Call) Service Enumeration | 0xffsec Handbook</title><link rel=manifest href=https://0xffsec.com/handbook/manifest.json><link rel=icon href=https://0xffsec.com/handbook/favicon.png type=image/x-icon><link rel=stylesheet href=https://0xffsec.com/handbook/book.min.3d1eee509180fc91bcb27edd77241647cffb75d6e0b74c450a2dfa2619498732.css integrity="sha256-PR7uUJGA/JG8sn7ddyQWR8/7ddbgt0xFCi36JhlJhzI="><script defer src=https://0xffsec.com/handbook/en.search.min.24113c619e148c1938be189e1145ff218a5d9ed6f076c21bdaaa3fa6a0ec5a46.js integrity="sha256-JBE8YZ4UjBk4vhieEUX/IYpdntbwdsIb2qo/pqDsWkY="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-142676329-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://0xffsec.com/handbook/><img src=https://0xffsec.com/handbook/images/logo.png alt=Logo><span>0xffsec Handbook</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-35d81374824c25dc2919edbbc61d971f class=toggle>
<label for=section-35d81374824c25dc2919edbbc61d971f class="flex justify-between"><a>Information Gathering</a>
<span>▾</span></label><ul><li><a href=https://0xffsec.com/handbook/information-gathering/assets-discovery/>Assets Discovery</a></li></ul></li><li><input type=checkbox id=section-235f64cfc2023c9b7289c228d0c51f53 class=toggle>
<label for=section-235f64cfc2023c9b7289c228d0c51f53 class="flex justify-between"><a>Discovery and Scanning</a>
<span>▾</span></label><ul><li><a href=https://0xffsec.com/handbook/discovery-and-scanning/host-discovery/>Host Discovery</a></li><li><a href=https://0xffsec.com/handbook/discovery-and-scanning/port-scanning/>Port Scanning</a></li></ul></li><li><a href=https://0xffsec.com/handbook/exploits-search/>Exploit Search</a></li><li><a href=https://0xffsec.com/handbook/brute-forcing/>Brute Forcing</a></li><li><input type=checkbox id=section-057108a1c1a3662b9db6ab679412fa8f class=toggle checked>
<label for=section-057108a1c1a3662b9db6ab679412fa8f class="flex justify-between"><a href=https://0xffsec.com/handbook/services/>Service Enumeration</a>
<span>▾</span></label><ul><li><a href=https://0xffsec.com/handbook/services/ftp/>FTP - 21</a></li><li><a href=https://0xffsec.com/handbook/services/smtp/>SMTP - 25 / 465 / 587</a></li><li><a href=https://0xffsec.com/handbook/services/dns/>DNS - 53</a></li><li><a href=https://0xffsec.com/handbook/services/finger/>Finger - 79</a></li><li><a href=https://0xffsec.com/handbook/services/http-https/>HTTP/S - 80 / 443</a></li><li><a href=https://0xffsec.com/handbook/services/pop/>POP - 110 / 995</a></li><li><a href=https://0xffsec.com/handbook/services/nntp/>NNTP - 119 / 433 / 563</a></li><li><a href=https://0xffsec.com/handbook/services/msrpc/ class=active>MSRPC - 135 / 593</a></li><li><a href=https://0xffsec.com/handbook/services/netbios/>NetBIOS - 137 / 138 / 139</a></li><li><a href=https://0xffsec.com/handbook/services/smb/>SMB - 139 / 445</a></li><li><a href=https://0xffsec.com/handbook/services/imap/>IMAP - 143 / 993</a></li></ul></li><li><a href=https://0xffsec.com/handbook/steganography/>Steganography</a></li><li><input type=checkbox id=section-4710461fd82136af748c8186e2a511e1 class=toggle>
<label for=section-4710461fd82136af748c8186e2a511e1 class="flex justify-between"><a>Web Applications</a>
<span>▾</span></label><ul><li><a href=https://0xffsec.com/handbook/web-applications/cgi/>CGI</a></li><li><a href=https://0xffsec.com/handbook/web-applications/command-injection/>Command Injection</a></li><li><a href=https://0xffsec.com/handbook/web-applications/csrf/>CSRF</a></li><li><a href=https://0xffsec.com/handbook/web-applications/file-inclusion-and-path-traversal/>LFI / RFI and Path Traversal</a></li></ul></li><li><input type=checkbox id=section-9b274a52224e37b079acf4aae5f9f128 class=toggle>
<label for=section-9b274a52224e37b079acf4aae5f9f128 class="flex justify-between"><a>Shells</a>
<span>▾</span></label><ul><li><a href=https://0xffsec.com/handbook/shells/reverse-shells/>Reverse Shells</a></li><li><a href=https://0xffsec.com/handbook/shells/full-tty/>Upgrade to Full TTY</a></li><li><a href=https://0xffsec.com/handbook/shells/restricted-shells/>Escape Restricted Shells</a></li></ul></li><li><a href=https://0xffsec.com/handbook/exfiltration/>Data Exfiltration</a></li><li><input type=checkbox id=section-ef46fe0aac274900fefdd5e564e236b2 class=toggle>
<label for=section-ef46fe0aac274900fefdd5e564e236b2 class="flex justify-between"><a href=https://0xffsec.com/handbook/notes/>Notes</a>
<span>▾</span></label><ul><li><a href=https://0xffsec.com/handbook/notes/how-to-open-jar-files/>JAR Files</a></li><li><a href=https://0xffsec.com/handbook/notes/smb-protocol-negotiation-failed/>SMB Protocol Negotiation Failed</a></li><li><a href=https://0xffsec.com/handbook/notes/ssh-legacy-key-exchange/>SSH Legacy Key Exchange</a></li></ul></li></ul><ul><li><a href=https://github.com/0xffsec/handbook target=_blank rel=noopener>GitHub</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://0xffsec.com/handbook/svg/menu.svg class=book-icon alt=Menu></label>
<strong>MSRPC (Microsoft Remote Procedure Call) Service Enumeration</strong>
<label for=toc-control><img src=https://0xffsec.com/handbook/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#enumeration>Enumeration</a><ul><li></li></ul></li><li><a href=#query-rpc>Query RPC</a><ul><li></li></ul></li><li><a href=#notable-rpc-interfaces-oreilly-net-assesment>Notable RPC Interfaces</a></li><li><a href=#further-reading>Further Reading</a></li></ul></nav></aside></header><article class=markdown><h1 id=msrpc>MSRPC</h1><div class=book-highlight><p><p>Microsoft Remote Procedure Call.</p><p><strong>Default Ports</strong>:</p><ul><li>RPC Endpoint Mapper: 135</li><li>HTTP: 593</li></ul></p></div><p>MSRPC is an interprocess communication (IPC) mechanism
that allows client/server software communcation.
That process can be on the same computer,
on the local network (LAN),
or across the Internet.
Its purpose is to
provide a common interface
between applications.</p><p>Within Windows environments,
many server applications
are exposed via RPC.</p><p>The Microsoft RPC mechanism
uses other IPC mechanisms,
such as named pipes,
<a href=https://0xffsec.com/handbook/services/netbios/>NetBIOS</a>
or Winsock,
to establish communications
between the client and the server.
Along with <code>IPC$</code> transport,
TCP, UDP, and HTTP
are used to provide access to services</p><figure><img src=https://0xffsec.com/handbook/images/msrpc.png alt=MSRPC><figcaption><h4>Source: Network Security Assesment 3rd Edition.</h4></figcaption></figure><p>The RPC locator service
works much like the RPC portmapper service
found in Unix environments.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><h2 id=enumeration>Enumeration</h2><p>You can query the RPC locator service
and individual RPC endpoints
to catalog services running over
TCP, UDP, HTTP, and SMB (via named pipes).</p><p>Each returned IFID value
represents an RPC service.
See <a href=#notable-rpc-interfaces-oreilly-net-assesment>Notable RPC Interfaces</a>.</p><p>By default, <code>impacket</code>
will try to match them
with a list of well known endpoints.
<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><h4 id=impacket-pcdumppy-impacket>impacket <code>pcdump.py</code> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></h4><p>Dump the list of RPC endpoints.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>rpcdump.py 10.0.0.3
</code></pre></div><details><summary>Parameters</summary><div class=markdown-inner><ul><li><code>target</code>: <code>[[domain/]username[:password]@]address</code></li><li><code>-port &lt;ports></code>: Destination port to connect to SMB server. Default: 135.</li></ul></div></details><h4 id=impacket-samrdumppy-impacket>impacket <code>samrdump.py</code> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></h4><p>List system user accounts,
available resource shares
and other sensitive information
exported through the SAMR (Security Account Manager Remote) interface.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>samrdump.py 10.0.0.3
</code></pre></div><details><summary>Parameters</summary><div class=markdown-inner><ul><li><code>target</code>: <code>[[domain/]username[:password]@]address</code></li><li><code>-port &lt;ports></code>: Destination port to connect to SMB server. Default: 445.</li></ul></div></details><h4 id=msrpc-enumhttpsnmaporgnsedocscriptsmsrpc-enumhtml-nse-script><a href=https://nmap.org/nsedoc/scripts/msrpc-enum.html>msrpc-enum</a> NSE Script</h4><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>nmap -sV -script msrpc-enum -Pn 10.0.0.3
</code></pre></div><h2 id=query-rpc>Query RPC</h2><p>The <code>rpcclient</code> can be used to interact with
individual RPC endpoints via named pipes.
By default,
Windows systems and Windows 2003 domain controllers
allow anonymous (<a href=https://0xffsec.com/handbook/services/smb/#null-session>Null Sessions</a>) access to SMB,
so these interfaces
can be queried in this way.</p><div class=book-note><div class=book-note-icon><svg width="23" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 60a15 15 0 000 30c50 0 90 40 90 90a15 15 0 0030 0c0-66-54-120-120-120z"/><path d="M217 4a179 179 0 00-96 295c19 22 30 49 30 77v30c0 20 13 37 31 43 6 35 36 63 74 63s68-28 74-63c18-6 31-23 31-43v-30c0-28 11-55 30-78A180 180 0 00217 4zm39 478c-19 0-36-13-42-31h84c-6 18-23 31-42 31zm75-76c0 8-7 15-15 15H196c-8 0-15-7-15-15v-15h150v15zm38-127c-21 24-34 52-37 82H180c-3-30-16-59-36-82a150 150 0 11225 0zM45 180H15a15 15 0 000 30h30a15 15 0 000-30z"/><path d="M51 105 30 84A15 15 0 109 105l21 21a15 15 0 1021-21zm0 159c-6-6-15-6-21 0L9 285a15 15 0 1021 21l21-21c6-6 6-15 0-21zm446-84h-30a15 15 0 000 30h30a15 15 0 000-30zm6-96c-6-6-15-6-21 0l-21 21a15 15 0 1021 21l21-21c6-6 6-15 0-21zm0 201-21-21a15 15 0 10-21 21l21 21a15 15 0 0021-21z"/></svg></div><div class=book-note-text><p><b>Note:</b>
If null session access
is not permitted,
a valid username and password must be provided.</p></div></div><h4 id=rpcclient-rpcclient>rpcclient <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></h4><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>rpcclient -U <span style=color:#ed9d13>&#34;&#34;</span> -N 10.0.0.3
</code></pre></div><details><summary>Parameters</summary><div class=markdown-inner><ul><li><code>-U</code>: Set the network username.</li><li><code>-N</code>: Don&rsquo;t ask for a password.</li></ul></div></details><p>Commands that you can issue to SAMR, LSARPC, and LSARPC-DS.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><table><thead><tr><th>Command</th><th>Interface</th><th>Description</th></tr></thead><tbody><tr><td><code>queryuser</code></td><td>SAMR</td><td>Retrieve user information.</td></tr><tr><td><code>querygroup</code></td><td>SAMR</td><td>Retrieve group information.</td></tr><tr><td><code>querydominfo</code></td><td>SAMR</td><td>Retrieve domain information.</td></tr><tr><td><code>enumdomusers</code></td><td>SAMR</td><td>Enumerate domain users.</td></tr><tr><td><code>enumdomgroups</code></td><td>SAMR</td><td>Enumerate domain groups.</td></tr><tr><td><code>createdomuser</code></td><td>SAMR</td><td>Create a domain user.</td></tr><tr><td><code>deletedomuser</code></td><td>SAMR</td><td>Delete a domain user.</td></tr><tr><td><code>lookupnames</code></td><td>LSARPC</td><td>Look up usernames to SID values.</td></tr><tr><td><code>lookupsids</code></td><td>LSARPC</td><td>Look up SIDs to usernames (RID cycling).</td></tr><tr><td><code>lsaaddacctrights</code></td><td>LSARPC</td><td>Add rights to a user account.</td></tr><tr><td><code>lsaremoveacctrights</code></td><td>LSARPC</td><td>Remove rights from a user account.</td></tr><tr><td><code>dsroledominfo</code></td><td>LSARPC-DS</td><td>Get primary domain information.</td></tr><tr><td><code>dsenumdomtrusts</code></td><td>LSARPC-DS</td><td>Enumerate trusted domains within an AD forest</td></tr></tbody></table><h2 id=notable-rpc-interfaces-oreilly-net-assesment>Notable RPC Interfaces <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></h2><p><strong>IFID</strong>: 12345778-1234-abcd-ef00-0123456789ab<br><strong>Named Pipe</strong>: <code>\pipe\lsarpc</code><br><strong>Description</strong>: LSA interface, used to enumerate users.</p><p><strong>IFID</strong>: 3919286a-b10c-11d0-9ba8-00c04fd92ef5<br><strong>Named Pipe</strong>: <code>\pipe\lsarpc</code><br><strong>Description</strong>: LSA Directory Services (DS) interface, used to enumerate domains and trust relationships.</p><p><strong>IFID</strong>: 12345778-1234-abcd-ef00-0123456789ac<br><strong>Named Pipe</strong>: <code>\pipe\samr</code><br><strong>Description</strong>: LSA SAMR interface, used to access public SAM database elements (e.g., usernames) and brute-force user passwords regardless of account lockout policy.</p><p><strong>IFID</strong>: 1ff70682-0a51-30e8-076d-740be8cee98b<br><strong>Named Pipe</strong>: <code>\pipe\atsvc</code><br><strong>Description</strong>: Task scheduler, used to remotely execute commands.</p><p><strong>IFID</strong>: 338cd001-2244-31f1-aaaa-900038001003<br><strong>Named Pipe</strong>: <code>\pipe\winreg</code><br><strong>Description</strong>: Remote registry service, used to access and modify the system registry.</p><p><strong>IFID</strong>: 367abb81-9844-35f1-ad32-98f038001003<br><strong>Named Pipe</strong>: <code>\pipe\svcctl</code><br><strong>Description</strong>: Service control manager and server services, used to remotely start and stop services and execute commands.</p><p><strong>IFID</strong>: 4b324fc8-1670-01d3-1278-5a47bf6ee188<br><strong>Named Pipe</strong>: <code>\pipe\srvsvc</code><br><strong>Description</strong>: Service control manager and server services, used to remotely start and stop services and execute commands.</p><p><strong>IFID</strong>: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57<br><strong>Named Pipe</strong>: <code>\pipe\epmapper</code><br><strong>Description</strong>: DCOM interface, used for brute-force password grinding and information gathering via WM.</p><h2 id=further-reading>Further Reading</h2><ul><li><a href=https://www.secureauth.com/labs/open-source-tools/impacket>Impacket | SecureAuth</a></li></ul><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>“How RPC Works: Remote Procedure Call (RPC).” Technical Documentation, API, and Code Examples | Microsoft Docs, <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc738291(v=ws.10)?redirectedfrom=MSDN">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc738291(v=ws.10)?redirectedfrom=MSDN</a>. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>McNab, Chris. Network Security Assessment, 3rd Edition. O’Reilly Media, Inc., 2016. <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>“Impacket | SecureAuth.” SecureAuth, <a href=https://www.secureauth.com/labs/open-source-tools/impacket>https://www.secureauth.com/labs/open-source-tools/impacket</a>. <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>“Rpcclient(1) - Linux Man Page.” Linux Documentation, <a href=https://linux.die.net/man/1/rpcclient>https://linux.die.net/man/1/rpcclient</a>. <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/0xffsec/handbook/commit/511eca92951f655454a54f966192527e14296743 title="Last modified by Max Rodrigo | October 25, 2020" target=_blank rel=noopener><img src=https://0xffsec.com/handbook/svg/calendar.svg class=book-icon alt=Calendar>
<span>October 25, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/0xffsec/handbook/edit/master/content//services/msrpc.md target=_blank rel=noopener><img src=https://0xffsec.com/handbook/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#enumeration>Enumeration</a><ul><li></li></ul></li><li><a href=#query-rpc>Query RPC</a><ul><li></li></ul></li><li><a href=#notable-rpc-interfaces-oreilly-net-assesment>Notable RPC Interfaces</a></li><li><a href=#further-reading>Further Reading</a></li></ul></nav></aside></main></body></html>